; contract: https://github.com/ethereum/eth2.0-specs/blob/v0.8.0/deposit_contract/contracts/validator_registration.v.py

[root]
comment:
k: #execute => _
schedule: PETERSBURG
output: _ => _
status_code: _ => _
call_stack: _
this: ACCT_ID
msg_sender: _
call_data: _
call_value: _
word_stack: .WordStack => _
local_mem: .Map => _
pc: 0 => _
gas: #gas(INIT_GAS, 0, 0) => _
memory_used: 0 => _
call_depth: CALL_DEPTH
log: _ => _
refund: _ => _
coinbase: _
active_accounts: SetItem({THIS}) _:Set
balance: _ => _
storage: _ => _
orig_storage: _ => _
nonce: _ => _
accounts:
requires:
    andBool #range(0 <= CALL_DEPTH < 1024)
ensures:
attribute:

; TODO:
; account 1 has to be active, otherwise there will be branching on <k>: #accountNonexistent(1)
; activeAccounts: SetItem({THIS}) SetItem(1) _:Set

[getHashTreeRoot]
call_data: #abiCallData("get_hash_tree_root", .TypedArgs)
call_value: CALL_VALUE
storage: M
requires:
    andBool CALL_VALUE ==Int 0
    andBool select(M, #hashedLocation({COMPILER}, {DEPOSIT_COUNT}, .IntList)) ==Int DEPOSIT_COUNT
;   andBool select(M, #hashedLocation({COMPILER}, {BRANCH}, .IntList)       ) ==Int BRANCH_0
;   andBool select(M, #hashedLocation({COMPILER}, {BRANCH}, .IntList) +Int 1) ==Int BRANCH_1
;   andBool select(M, #hashedLocation({COMPILER}, {BRANCH}, .IntList) +Int 2) ==Int BRANCH_2
    andBool #rangeUInt(256, DEPOSIT_COUNT)

[getHashTreeRoot-init]
k: #execute
pc: 0 => 689
gas: #gas(INIT_GAS, 0, 0) => #gas(INIT_GAS, 375, 42)
memory_used: 0 => 14
local_mem: .Map => .Map
    ; function hash
    [  28 <- 134 ]
    [  29 <-  58 ]
    [  30 <-  49 ]
    [  31 <-  27 ]
    ; bounds - vyper generated
    [  32 := #buf(32, 1461501637330902918203684832716283019655932542976) ]
    [  64 := #buf(32, 170141183460469231731687303715884105727) ]
    [  96 := #buf(32, 115792089237316195423570985008687907853099843482180094807725896704197245534208) ]
    [ 128 := #buf(32, 1701411834604692317316873037158841057270000000000) ]
    [ 160 := #buf(32, 115792089237316195423570985006986496018665292348323691002298742950633129639936) ]
    ; zero_bytes32: bytes32 = 0x0
    ; node: bytes32 = zero_bytes32
    ; size: uint256 = self.deposit_count
    ; height = 0
    [ 320 := #buf(32, 0) ]
    [ 352 := #buf(32, 0) ]
    [ 384 := #buf(32, DEPOSIT_COUNT) ]
    [ 416 := #buf(32, 0) ]
word_stack: .WordStack => 32 : 416 : .WordStack
; no changes
output: _
status_code: _
log: _
refund: _
balance: _
orig_storage: _
nonce: _
;local_mem:
;   .Map => storeRange(storeRange(storeRange(storeRange(storeRange(storeRange(storeRange(storeRange(storeRange(
;       ; function hash
;        28 |-> 134
;        29 |->  58
;        30 |->  49
;        31 |->  27,
;       ; bounds
;        32, 32, #buf(32, 1461501637330902918203684832716283019655932542976)),
;        64, 32, #buf(32, 170141183460469231731687303715884105727)),
;        96, 32, #buf(32, 115792089237316195423570985008687907853099843482180094807725896704197245534208)),
;       128, 32, #buf(32, 1701411834604692317316873037158841057270000000000)),
;       160, 32, #buf(32, 115792089237316195423570985006986496018665292348323691002298742950633129639936)),
;       ; zero_bytes32: bytes32 = 0x0
;       ; node: bytes32 = zero_bytes32
;       ; size: uint256 = self.deposit_count
;       ; height = 0
;       320, 32, #buf(32, 0)),
;       352, 32, #buf(32, 0)),
;       384, 32, #buf(32, DEPOSIT_COUNT)),
;       416, 32, #buf(32, 0))

[getHashTreeRoot-loop]
k: #execute
pc_loophead: 689
gas_loophead: #gas(INIT_GAS, 375, 42)
memory_used_loophead: 14
local_mem_loophead: .Map
    ; function hash
    [  28 <- 134 ]
    [  29 <-  58 ]
    [  30 <-  49 ]
    [  31 <-  27 ]
    ; bounds - vyper generated
    [  32 := #buf(32, 1461501637330902918203684832716283019655932542976) ]
    [  64 := #buf(32, 170141183460469231731687303715884105727) ]
    [  96 := #buf(32, 115792089237316195423570985008687907853099843482180094807725896704197245534208) ]
    [ 128 := #buf(32, 1701411834604692317316873037158841057270000000000) ]
    [ 160 := #buf(32, 115792089237316195423570985006986496018665292348323691002298742950633129639936) ]
    ; zero_bytes32: bytes32 = 0x0
    ; node: bytes32 = zero_bytes32
    ; size: uint256 = self.deposit_count
    ; height = 0
    [ 320 := #buf(32, 0) ]
    [ 352 := #buf(32, 0) ]
    [ 384 := #buf(32, DEPOSIT_COUNT) ]
    [ 416 := #buf(32, 0) ]
word_stack_loophead: 32 : 416 : .WordStack
; no changes
output: _
status_code: _
log: _
refund: _
balance: _
orig_storage: _
nonce: _

[getHashTreeRoot-loop-1]
pc: {PC_LOOPHEAD} => 963
gas: {GAS_LOOPHEAD} => _
memory_used: {MEMORY_USED_LOOPHEAD} => _
local_mem: {LOCAL_MEM_LOOPHEAD} => {LOCAL_MEM_LOOPHEAD}
    [ 192 := #buf(32, 0) ] /* branch index */
    [ 608 := #buf(32, BRANCH_0) ]
    [ 640 := #buf(32, 0) ] /* node */
    [ 576 := #buf(32, 64) ] /* size of concat */
word_stack: {WORD_STACK_LOOPHEAD} => _
requires:
    andBool DEPOSIT_COUNT &Int 1 ==Int 1

[pgm]
compiler: "Solidity"
; Storage variables:
; branch: bytes32[DEPOSIT_CONTRACT_TREE_DEPTH]
; deposit_count: uint256
; zero_hashes: bytes32[DEPOSIT_CONTRACT_TREE_DEPTH]
branch: 0
deposit_count: 1
zero_hashes: 2
; Constants:
; MIN_DEPOSIT_AMOUNT: constant(uint256) = 1000000000  # Gwei
; DEPOSIT_CONTRACT_TREE_DEPTH: constant(uint256) = 32
; MAX_DEPOSIT_COUNT: constant(uint256) = 4294967295 # 2**DEPOSIT_CONTRACT_TREE_DEPTH - 1
; PUBKEY_LENGTH: constant(uint256) = 48  # bytes
; WITHDRAWAL_CREDENTIALS_LENGTH: constant(uint256) = 32  # bytes
; AMOUNT_LENGTH: constant(uint256) = 8  # bytes
; SIGNATURE_LENGTH: constant(uint256) = 96  # bytes
deposit_contract_tree_depth: 32
code: "0x600035601c52740100000000000000000000000000000000000000006020526f7fffffffffffffffffffffffffffffff6040527fffffffffffffffffffffffffffffffff8000000000000000000000000000000060605274012a05f1fffffffffffffffffffffffffdabf41c006080527ffffffffffffffffffffffffed5fa0e000000000000000000000000000000000060a052600015610277575b6101605261014052600061018052610140516101a0526101c060006008818352015b61018051600860008112156100da578060000360020a82046100e1565b8060020a82025b905090506101805260ff6101a051166101e052610180516101e0516101805101101561010c57600080fd5b6101e0516101805101610180526101a0517ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff86000811215610155578060000360020a820461015c565b8060020a82025b905090506101a0525b81516001018083528114156100bd575b50506018600860208206610200016020828401111561019357600080fd5b60208061022082610180600060046015f15050818152809050905090508051602001806102c0828460006004600a8704601201f16101d057600080fd5b50506102c05160206001820306601f82010390506103206102c0516008818352015b826103205111156102025761021e565b6000610320516102e001535b81516001018083528114156101f2575b50505060206102a05260406102c0510160206001820306601f8201039050610280525b6000610280511115156102535761026f565b602061028051036102a001516020610280510361028052610241565b610160515650005b63863a311b600051141561050857341561029057600080fd5b6000610140526101405161016052600154610180526101a060006020818352015b60016001610180511614156103325760006101a051602081106102d357600080fd5b600060c052602060c02001546020826102400101526020810190506101605160208261024001015260208101905080610240526102409050602060c0825160208401600060025af161032457600080fd5b60c0519050610160526103a0565b6000610160516020826101c00101526020810190506101a0516020811061035857600080fd5b600260c052602060c02001546020826101c0010152602081019050806101c0526101c09050602060c0825160208401600060025af161039657600080fd5b60c0519050610160525b61018060026103ae57600080fd5b60028151048152505b81516001018083528114156102b1575b505060006101605160208261046001015260208101905061014051610160516101805163806732896102e05260015461030052610300516006580161009b565b506103605260006103c0525b6103605160206001820306601f82010390506103c0511015156104355761044e565b6103c05161038001526103c0516020016103c052610413565b61018052610160526101405261036060088060208461046001018260208501600060046012f150508051820191505060006018602082066103e0016020828401111561049957600080fd5b60208061040082610140600060046015f150508181528090509050905060188060208461046001018260208501600060046014f150508051820191505080610460526104609050602060c0825160208401600060025af16104f957600080fd5b60c051905060005260206000f3005b63621fd130600051141561061a57341561052157600080fd5b63806732896101405260015461016052610160516006580161009b565b506101c0526000610220525b6101c05160206001820306601f82010390506102205110151561056c57610585565b610220516101e00152610220516020016102205261054a565b6101c0805160200180610280828460006004600a8704601201f16105a857600080fd5b50506102805160206001820306601f82010390506102e0610280516008818352015b826102e05111156105da576105f6565b60006102e0516102a001535b81516001018083528114156105ca575b5050506020610260526040610280510160206001820306601f8201039050610260f3005b63c47e300d60005114156110c657605060043560040161014037603060043560040135111561064857600080fd5b60406024356004016101c037602060243560040135111561066857600080fd5b608060443560040161022037606060443560040135111561068857600080fd5b63ffffffff6001541061069a57600080fd5b633b9aca006102e0526102e0516106b057600080fd5b6102e05134046102c052633b9aca006102c05110156106ce57600080fd5b603061014051146106de57600080fd5b60206101c051146106ee57600080fd5b606061022051146106fe57600080fd5b610140610360525b6103605151602061036051016103605261036061036051101561072857610706565b6380673289610380526102c0516103a0526103a0516006580161009b565b50610400526000610460525b6104005160206001820306601f8201039050610460511015156107745761078d565b6104605161042001526104605160200161046052610752565b610340610360525b61036051526020610360510361036052610140610360511015156107b857610795565b610400805160200180610300828460006004600a8704601201f16107db57600080fd5b5050610140610480525b61048051516020610480510161048052610480610480511015610807576107e5565b63806732896104a0526001546104c0526104c0516006580161009b565b50610520526000610580525b6105205160206001820306601f8201039050610580511015156108525761086b565b6105805161054001526105805160200161058052610830565b610460610480525b610480515260206104805103610480526101406104805110151561089657610873565b6105208051602001806105a0828460006004600a8704601201f16108b957600080fd5b505060a06106205261062051610660526101408051602001806106205161066001828460006004600a8704601201f16108f157600080fd5b505061062051610660015160206001820306601f8201039050610620516106600161060081516040818352015b836106005110151561092f5761094c565b6000610600516020850101535b815160010180835281141561091e575b50505050602061062051610660015160206001820306601f82010390506106205101016106205261062051610680526101c08051602001806106205161066001828460006004600a8704601201f16109a357600080fd5b505061062051610660015160206001820306601f8201039050610620516106600161060081516020818352015b83610600511015156109e1576109fe565b6000610600516020850101535b81516001018083528114156109d0575b50505050602061062051610660015160206001820306601f820103905061062051010161062052610620516106a0526103008051602001806106205161066001828460006004600a8704601201f1610a5557600080fd5b505061062051610660015160206001820306601f8201039050610620516106600161060081516020818352015b8361060051101515610a9357610ab0565b6000610600516020850101535b8151600101808352811415610a82575b50505050602061062051610660015160206001820306601f820103905061062051010161062052610620516106c0526102208051602001806106205161066001828460006004600a8704601201f1610b0757600080fd5b505061062051610660015160206001820306601f8201039050610620516106600161060081516060818352015b8361060051101515610b4557610b62565b6000610600516020850101535b8151600101808352811415610b34575b50505050602061062051610660015160206001820306601f820103905061062051010161062052610620516106e0526105a08051602001806106205161066001828460006004600a8704601201f1610bb957600080fd5b505061062051610660015160206001820306601f8201039050610620516106600161060081516020818352015b8361060051101515610bf757610c14565b6000610600516020850101535b8151600101808352811415610be6575b50505050602061062051610660015160206001820306601f8201039050610620510101610620527f649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c561062051610660a160006107005260006101406030806020846107c001018260208501600060046016f150508051820191505060006010602082066107400160208284011115610cab57600080fd5b60208061076082610700600060046015f15050818152809050905090506010806020846107c001018260208501600060046013f1505080518201915050806107c0526107c09050602060c0825160208401600060025af1610d0b57600080fd5b60c0519050610720526000600060406020820661086001610220518284011115610d3457600080fd5b606080610880826020602088068803016102200160006004601bf1505081815280905090509050602060c0825160208401600060025af1610d7457600080fd5b60c0519050602082610a600101526020810190506000604060206020820661092001610220518284011115610da857600080fd5b606080610940826020602088068803016102200160006004601bf15050818152809050905090506020806020846109e001018260208501600060046015f1505080518201915050610700516020826109e0010152602081019050806109e0526109e09050602060c0825160208401600060025af1610e2557600080fd5b60c0519050602082610a6001015260208101905080610a6052610a609050602060c0825160208401600060025af1610e5c57600080fd5b60c0519050610840526000600061072051602082610b000101526020810190506101c0602080602084610b0001018260208501600060046015f150508051820191505080610b0052610b009050602060c0825160208401600060025af1610ec257600080fd5b60c0519050602082610c800101526020810190506000610300600880602084610c0001018260208501600060046012f15050805182019150506000601860208206610b800160208284011115610f1757600080fd5b602080610ba082610700600060046015f1505081815280905090509050601880602084610c0001018260208501600060046014f150508051820191505061084051602082610c0001015260208101905080610c0052610c009050602060c0825160208401600060025af1610f8a57600080fd5b60c0519050602082610c8001015260208101905080610c8052610c809050602060c0825160208401600060025af1610fc157600080fd5b60c0519050610ae0526001805460018254011015610fde57600080fd5b6001815401815550600154610d0052610d2060006020818352015b60016001610d005116141561102e57610ae051610d20516020811061101d57600080fd5b600060c052602060c02001556110c2565b6000610d20516020811061104157600080fd5b600060c052602060c0200154602082610d40010152602081019050610ae051602082610d4001015260208101905080610d4052610d409050602060c0825160208401600060025af161109257600080fd5b60c0519050610ae052610d0060026110a957600080fd5b60028151048152505b8151600101808352811415610ff9575b5050005b60006000fd"
